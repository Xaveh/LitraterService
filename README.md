# Litrater Service

## üìö About This Application

Litrater is a comprehensive book storage and review platform where users can discover books, create detailed reviews, and share their reading experiences with fellow book enthusiasts. The application serves as a central hub for book lovers to connect, discuss, and explore literature together.

**Note:** This codebase was primarily generated by AI but has been carefully reviewed and overseen by a developer to ensure quality, functionality, and adherence to best practices.

## üéØ Purpose

A modern, well-architected .NET 9 Web API showcasing advanced software engineering practices and design patterns. This portfolio application demonstrates expertise in building scalable, maintainable, and testable enterprise-grade applications.

## üèóÔ∏è Architecture & Design Patterns

- Domain-Driven Design (DDD)
- Clean Architecture
- CQRS (Command Query Responsibility Segregation)
  - Due to recent license changes, decorator classes are used instead of MediatR

## üõ†Ô∏è Technical Stack

### Core Framework
- **.NET 9**: Latest .NET version with cutting-edge features
- **ASP.NET Core Minimal APIs**: Modern, lightweight API endpoints
- **Entity Framework Core 9**: Latest ORM with PostgreSQL support

### Database & Data Access
- **PostgreSQL**: Robust, open-source relational database
- **Entity Framework Core**: Code-first approach with migrations
- **Repository Pattern**: Abstracted data access layer
- **Unit of Work Pattern**: Transactional consistency across repositories

### Authentication & Authorization
- **Keycloak Authentication & Authorization**: Centralized identity and access management
- **Role-Based Authorization**: Flexible authorization policies managed by Keycloak

### Validation & Error Handling
- **FluentValidation**: Comprehensive input validation
- **Ardalis.Result**: Functional result pattern instead of exceptions
- **Problem Details**: RFC 7807 compliant error responses
- **Global Exception Handler**: Centralized error handling

### Logging & Monitoring
- **Serilog**: Structured logging with multiple sinks
- **Request Logging**: Automatic HTTP request/response logging
- **Health Checks**: Application and database health monitoring

### API Design
- **API Versioning**: Support for multiple API versions
- **OpenAPI/Swagger**: Comprehensive API documentation
- **Minimal APIs**: Modern, performant endpoint definitions
- **Problem Details**: Standardized error responses

## üß™ Testing Strategy

### Test Types
- **Unit Tests**: Isolated testing of business logic
- **Integration Tests**: End-to-end API testing
- **Architecture Tests**: Dependency and design rule validation

### Testing Tools
- **xUnit**: Modern testing framework
- **Moq**: Mocking framework for unit tests
- **Shouldly**: Fluent assertion library (replacing FluentAssertions due to license changes)
- **Testcontainers**: Isolated PostgreSQL containers for integration tests
- **Respawn**: Database state reset between tests

### Test Coverage
- **Command/Query Handlers**: Full unit test coverage
- **Validators**: Comprehensive validation testing
- **Endpoints**: Integration tests for all API endpoints
- **Architecture Rules**: Automated dependency validation

## üöÄ Development Tools & Practices

### Code Quality
- **SonarAnalyzer**: Static code analysis and quality gates
- **EditorConfig**: Consistent coding standards across editors
- **Central Package Management**: Version control via `Directory.Packages.props`

### Dependency Injection
- **Scrutor**: Assembly scanning and decorator registration
- **Service Lifetime Management**: Proper scoping of dependencies

### Development Experience
- **HTTP Files**: Manual testing with `.http` files
- **Docker Compose**: Local development environment

## üöÄ Getting Started

### Prerequisites
- Docker Desktop (for containerized development)

### Running the Application

The recommended and only supported way to run the application is via **Docker Compose**. This will start all required services, including the API, PostgreSQL database, and Keycloak for authentication.

#### Clone the repository
```bash
git clone <repository-url>
cd LitraterService
```

#### Start the application
```bash
docker-compose up -d
```
This will start:
- PostgreSQL database
- Litrater API service
- Keycloak authentication server (with preconfigured users)
- Automatic database migrations and seeding

#### Access the API & Swagger UI

- **Swagger UI**: https://localhost:5001/swagger
- **API**: https://localhost:5001
- **Health Check**: https://localhost:5001/health

**Authentication for Swagger UI:**

1. Click the **Authorize** button in Swagger UI.
2. Log in with one of the following predefined users:
   - **Regular user**  
     Email: `user@litrater.com`  
     Password: `user123`
   - **Admin user**  
     Email: `admin@litrater.com`  
     Password: `admin123`

Keycloak handles all authentication and authorization. No custom JWT logic is used.